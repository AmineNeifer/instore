## ``instore`` Service and Client 

- `` instore`` is a microservice which is responsible for managing an in-memory
key-value store. The user of that service can add, retrieve, remove... key-value pairs via that service. 

- ``instore`` service and the consumer of that service are implemented in both ``Go`` language.

- This use case shows how you can implement both ``instore`` service and its consumer.

## Service Definition 

```proto
package store;

option go_package="storepb";

message StoreRequest {
    string key = 1;
    string value = 2;
}

message StoreResponse {
    string result = 1;
}

message RemoveRequest {
    string key = 1;
    string value = 2;
}

message RemoveResponse {
    string result = 1;
}

message GetVRequest {
    string key = 1;
}

message GetVResponse {
    string result = 1;
}

message GetKRequest {
    string value = 2;
}

message GetKResponse {
    string result = 1;
}

message RemoveAllRequest {
    string msg = 1;
}

message RemoveAllResponse {
    string result = 1;
}

message StoreCsvRequest {
    string key = 1;
    string value = 2;
}
message StoreCsvResponse {
    string result = 1;
}

message RemoveCsvRequest {
    string key = 1;
    string value = 2;
}

message RemoveCsvResponse {
    string result = 1;
}

message GetAllRequest {
    string msg = 1;
}

message GetAllResponse {
    string key = 1;
    string value = 2;
}

service StoreService {
    // Unary
    rpc Store(StoreRequest) returns (StoreResponse) {};
    rpc Remove(RemoveRequest) returns (RemoveResponse) {};
    rpc GetV(GetVRequest) returns (GetVResponse) {};
    rpc GetK(GetKRequest) returns (GetKResponse) {};
    rpc RemoveAll(RemoveAllRequest) returns (RemoveAllResponse) {};
    // client streaming
    rpc StoreCsv(stream StoreCsvRequest) returns (StoreCsvResponse) {};
    rpc RemoveCsv(stream RemoveCsvRequest) returns (RemoveCsvResponse) {};
    // server streaming
    rpc GetAll(GetAllRequest) returns (stream GetAllResponse) {};
}
```

## Implementation

## Building and Running Server

In order to build, Go to location (instore/server) and execute the following
 shell command,
```
go build -o bin/server
```

In order to run, Go to location (instore/server) and execute the following
shell command,

```
./bin/server
```

## Building and Running Client

In order to build, Go to location (instore/command) and execute the following
 shell command,
```
go build -i -v -o bin/command
```

In order to run, Go to location (instore/command) and execute the following
shell command,

```
./bin/command
```

You will be prompted to a ``CLI``, here is an example of the experience
```
[cmd]  Hello! I am excited to have you as a user :D Enjoy!
[cmd]  You could use any of these commands
[cmd]  -----------------------------------------------------------------------------
[cmd]  add       <key>  <value>  ------- to add a key-value pair to the store
[cmd]  get[v]    <key>           ------- to get existing values corresponding to a key from the store
[cmd]  getk      <value>         ------- to get existing keys corresponding to a value from the store
[cmd]  remove    <key>  <value>  ------- to remove a key-value pair from the store
[cmd]  exit/quit                 ------- to quit the program
[cmd]  -----------------------------------------------------------------------------
[usr]> add key value
[srv]  Added: {'key': 'value'}
[usr]> add tunis france
[srv]  Added: {'tunis': 'france'}
[usr]> add zenly job
[srv]  Added: {'zenly': 'job'}
[usr]> add amine neifer
[srv]  Added: {'amine': 'neifer'}
[usr]> remove all
[srv]  All removed
[usr]> exit
[cmd]  Bye Bye! :)
```
``[cmd] `` is output generated by the command.go file
``[usr]>`` is prefix to show that it is waiting for the user input
``[svr] `` is output generated by the server.go file
``[clt] `` is output generated by the client.go


## Additional Information
### Commands
#### add
``add Tunisia tunis`` adds ``Tunsia-tunis`` key-value pair to ``data.csv`` 
#### addcsv
``add new.csv`` adds ``new.csv`` key-value pairs to ``data.csv`` 
#### get / getv
``get Tunisia`` prints values paired to the key ``Tunsia`` in ``data.csv`` 
#### getall
``getall`` prints all key-value pairs in ``data.csv`` 
#### getk
``get tunis`` prints keys paired with the value ``tunis`` in ``data.csv`` 
#### remove / delete
``remove Tunisia tunis`` removes ``Tunsia-tunis`` key-value pair from ``data.csv`` 
#### removecsv
``removecsv new.csv`` remove key-value pairs from ``data.csv`` that are present in ``new.csv`` 
### Csv files used in the service
``data.csv`` is generated in the same directory from which you executed server.go
if you generated a new csv file from which you want to add to data.csv with ``addcsv`` command
the file needs to be in the directory in which you ran command.go 

### Generate Server and Client side code 
Pre-generated stub file is included in the go project. If you need to generate the stub files please use the below
 command from the root directory(inside instore directory)
``` 
protoc storepb/store.proto --go_out=plugins=grpc:.
``` 
